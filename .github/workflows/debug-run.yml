name: DEBUG â€” Run bot now
on:
  workflow_dispatch:
    inputs:
      dry_run:
        description: "Set to 1 to skip posting; 0 to post"
        required: true
        default: "1"
      btc_tier:
        description: "BTC fee tier (fastestFee|halfHourFee|hourFee|economyFee|minumumFee)"
        required: false
        default: "hourFee"
      explainer_url:
        description: "Optional: link to more info"
        required: false
        default: ""

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm ci

      - name: Preflight
        run: npm run preflight
        env:
          DRY_RUN:       ${{ inputs.dry_run }}
          BTC_TIER:      ${{ inputs.btc_tier }}
          EXPLAINER_URL: ${{ inputs.explainer_url }}

      - name: Post metrics
        run: node post-metrics.js
        env:
          X_APP_KEY:       ${{ secrets.X_APP_KEY }}
          X_APP_SECRET:    ${{ secrets.X_APP_SECRET }}
          X_ACCESS_TOKEN:  ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_SECRET: ${{ secrets.X_ACCESS_SECRET }}
          DRY_RUN:         ${{ inputs.dry_run }}
          BTC_TIER:        ${{ inputs.btc_tier }}
          EXPLAINER_URL:   ${{ inputs.explainer_url }}
