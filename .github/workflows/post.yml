name: Post metrics (every 8h)

on:
  schedule:
    # Every 8 hours at :00 UTC — 00:00, 08:00, 16:00
    - cron: "0 */8 * * *"
  workflow_dispatch: {}

permissions:
  contents: read

concurrency:
  group: post-metrics-bot
  cancel-in-progress: true

jobs:
  post:
    runs-on: ubuntu-latest
    env:
      # X (Twitter) API secrets — required to post
      X_APP_KEY:       ${{ secrets.X_APP_KEY }}
      X_APP_SECRET:    ${{ secrets.X_APP_SECRET }}
      X_ACCESS_TOKEN:  ${{ secrets.X_ACCESS_TOKEN }}
      X_ACCESS_SECRET: ${{ secrets.X_ACCESS_SECRET }}

      # Vars (configure under Actions → Variables)
      BTC_TIER:       ${{ vars.BTC_TIER || 'hourFee' }}
      EXPLAINER_URL:  ${{ vars.EXPLAINER_URL || '' }}

      # Must be empty here so we actually post
      DRY_RUN:        ""

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install deps
        run: npm ci

      - name: Post metrics
        run: node post-metrics.js
